<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>DODGE Ã— å¼¾å¹•ï¼ˆãƒªã‚¢ãƒ«ç”»åƒãƒ»é¿ã‘ã‚²ãƒ¼ï¼‰</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{margin:0;background:#000;color:#fff;text-align:center;font-family:sans-serif}
canvas{display:block;margin:auto;border:2px solid #555}
.controls{display:flex;justify-content:space-around;margin:15px}
.btn{width:120px;height:120px;font-size:48px;background:#222;color:#fff;border-radius:50%}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,.9);display:flex;flex-direction:column;justify-content:center;align-items:center}
.overlay button{margin:10px;padding:20px 40px;font-size:28px}
.flash{position:fixed;inset:0;background:rgba(255,0,0,.3);opacity:0;pointer-events:none}
.flash.on{opacity:1}
</style>
</head>
<body>

<h3>
ã‚¹ã‚³ã‚¢:<span id="score">0</span>
â¤ï¸:<span id="life">3</span>
ğŸ†:<span id="highScore">0</span>
</h3>

<canvas id="game" width="400" height="500"></canvas>

<div class="controls">
  <button class="btn" id="leftBtn">â—€</button>
  <button class="btn" id="rightBtn">â–¶</button>
</div>

<div class="overlay" id="titleScreen"><h1>TAP TO START</h1></div>

<div class="overlay" id="overlay" style="display:none">
  <h2>é›£æ˜“åº¦</h2>
  <button onclick="startGame('easy')">EASY</button>
  <button onclick="startGame('normal')">NORMAL</button>
  <button onclick="startGame('hard')">HARD</button>
</div>

<div class="overlay" id="gameOverScreen" style="display:none">
  <h1>GAME OVER</h1>
  <button onclick="goHome()">ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</button>
</div>

<div class="flash" id="flash"></div>

<script>
const ctx = game.getContext("2d");

/* ===== ç”»åƒèª­ã¿è¾¼ã¿ ===== */
const playerImg = new Image();
playerImg.src = "https://fastpng.com/thumb/spaceship/png-transparent-space-shuttle-rocket-spacecraft-spaceship-png-clip-art-thumbnail.png";

const enemyImgs = [new Image(), new Image()];
enemyImgs[0].src = "https://toppng.com/uploads/preview/spaceship-png-png-free-png-images-122847.png";
enemyImgs[1].src = "https://toppng.com/uploads/preview/spaceship-png-png-free-png-images-122837.png";

const meteorImg = new Image();
meteorImg.src = "https://fastpng.com/thumb/asteroid/png-transparent-asteroid-meteor-space-rock-asteroid-meteorite-spacecraft-spacecraft-asteroid-mammal-thumbnail.png";

/* ===== çŠ¶æ…‹ ===== */
let player=null, enemies=[], bullets=[];
let left=false,right=false;
let scoreV=0,lifeV=3,invincible=0;
let playing=false, enemyRate=0.03;
let highScoreV=localStorage.getItem("highScore")||0; highScore.textContent=highScoreV;

/* ===== æ“ä½œ ===== */
leftBtn.ontouchstart=e=>{e.preventDefault();left=true}; leftBtn.ontouchend=()=>left=false;
rightBtn.ontouchstart=e=>{e.preventDefault();right=true}; rightBtn.ontouchend=()=>right=false;

/* ===== å½“ãŸã‚Šåˆ¤å®š ===== */
function hitEllipseCircle(px,py,rx,ry,cx,cy,cr){ const dx=(cx-px)/rx; const dy=(cy-py)/ry; return dx*dx+dy*dy<=1; }

/* ===== æ•µç”Ÿæˆ ===== */
function createEnemy(){
  if(Math.random()<0.5){
    enemies.push({type:"meteor",x:Math.random()*350,y:-50,w:50,h:50,vy:1.5,rot:(Math.random()-0.5)*0.05,angle:0,img:meteorImg});
  } else {
    enemies.push({type:"ship",x:Math.random()*360,y:40,w:40,h:40,vx:(Math.random()<0.5?-1:1)*1.5,vy:0,shoot:0,img:enemyImgs[Math.floor(Math.random()*enemyImgs.length)]});
  }
}

/* ===== é–‹å§‹ ===== */
function startGame(diff){
  titleScreen.style.display="none"; overlay.style.display="none"; gameOverScreen.style.display="none";
  player={x:180,y:440,w:40,h:40}; enemies=[]; bullets=[];
  scoreV=0; invincible=0;
  if(diff==="easy"){lifeV=3; enemyRate=0.02;}
  else if(diff==="hard"){lifeV=2; enemyRate=0.05;}
  else{lifeV=3; enemyRate=0.03;}
  score.textContent=scoreV; life.textContent=lifeV; playing=true;
}

/* ===== ãƒ€ãƒ¡ãƒ¼ã‚¸ ===== */
function damage(){ if(invincible>0) return; lifeV--; life.textContent=lifeV; invincible=60; flash.classList.add("on"); setTimeout(()=>flash.classList.remove("on"),120); if(lifeV<=0) gameOver(); }
function gameOver(){ playing=false; gameOverScreen.style.display="flex"; overlay.style.display="flex"; }

/* ===== ãƒ›ãƒ¼ãƒ  ===== */
function goHome(){ gameOverScreen.style.display="none"; titleScreen.style.display="flex"; overlay.style.display="none"; }

/* ===== æ›´æ–° ===== */
function update(){
  if(!playing||!player) return;
  if(invincible>0) invincible--;
  if(left&&player.x>0) player.x-=6;
  if(right&&player.x<360) player.x+=6;

  // æ•µã¨å¼¾ã®å‹•ã
  for(const e of enemies){
    if(e.type==="meteor"){
      e.vy+=0.05; e.y+=e.vy; e.angle+=e.rot;
      if(hitEllipseCircle(player.x+20,player.y+22,12,16,e.x+25,e.y+25,25)) damage();
    } else {
      e.x+=e.vx;
      e.vy+=Math.sin(Date.now()/200+e.x)*0.5;
      e.y+=e.vy*0.1;
      if(e.x<0||e.x>360) e.vx*=-1;
      e.shoot++;
      if(e.shoot>60){
        const pattern=Math.floor(Math.random()*4);
        switch(pattern){
          case 0: bullets.push({x:e.x+20,y:e.y+30,vx:0,vy:4,w:6,h:16,color:"#ffcc33"}); break;
          case 1: bullets.push({x:e.x+20,y:e.y+30,vx:2,vy:3,w:6,h:16,color:"#ff6666"});
                  bullets.push({x:e.x+20,y:e.y+30,vx:-2,vy:3,w:6,h:16,color:"#ff6666"}); break;
          case 2: bullets.push({x:e.x+20,y:e.y+30,vx:0,vy:3,w:5,h:14,color:"#33ff33"}); break;
          case 3: bullets.push({x:e.x+20,y:e.y+30,vx:0,vy:6,w:6,h:20,color:"#ffff33"}); break;
        }
        e.shoot=0;
      }
    }
  }

  for(const b of bullets){ b.x+=b.vx; b.y+=b.vy; if(hitEllipseCircle(player.x+20,player.y+22,12,16,b.x,b.y,b.w/2)) damage(); }
  enemies=enemies.filter(e=>e.y<520); bullets=bullets.filter(b=>b.y<520);
  scoreV++; score.textContent=scoreV; if(Math.random()<enemyRate) createEnemy();
}

/* ===== æç”» ===== */
function draw(){
  ctx.fillStyle="#000"; ctx.fillRect(0,0,400,500);
  if(player && invincible%10<5) ctx.drawImage(playerImg,player.x,player.y,40,40);
  for(const e of enemies){
    if(e.type==="meteor"){ ctx.save(); ctx.translate(e.x+25,e.y+25); ctx.rotate(e.angle); ctx.drawImage(e.img,-25,-25,50,50); ctx.restore(); }
    else ctx.drawImage(e.img,e.x,e.y,40,40);
  }
  for(const b of bullets){
    const grad=ctx.createLinearGradient(b.x,b.y,b.x,b.y+b.h);
    grad.addColorStop(0,"white"); grad.addColorStop(0.5,b.color); grad.addColorStop(1,"transparent");
    ctx.fillStyle=grad;
    ctx.fillRect(b.x-b.w/2,b.y,b.w,b.h);
  }
}

titleScreen.onclick=()=>{ titleScreen.style.display="none"; overlay.style.display="flex"; };
(function loop(){ update(); draw(); requestAnimationFrame(loop); })();
</script>

</body>
</html>
